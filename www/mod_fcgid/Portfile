# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                mod_fcgid
version             2.3.9
categories          www
license             Apache-2
platforms           darwin
maintainers         pixilla openmaintainer

description         An alternative FastCGI module for Apache2
long_description    ${description}

homepage            http://httpd.apache.org/mod_fcgid/
master_sites        apache:httpd/${name}

use_bzip2           yes

checksums           rmd160  cb5fd1fbf705ba3dff62a705d06c0632acd491bd \
                    sha256  442c29528e34fefc946dd356fcf8240e1953aed89eb5597fc55898d3d06f183f

depends_lib         port:apache2

patch.pre_args      -p1
patchfiles          patch-modules-fcgid-fcgid_conf.c.diff

post-patch {
    reinplace "s|@PREFIX@|${prefix}|g" \
        ${worksrcpath}/modules/fcgid/fcgid_conf.c
    reinplace "s|@NAME@|${name}|g" \
        ${worksrcpath}/modules/fcgid/fcgid_conf.c
}

configure.env       APXS=${prefix}/apache2/bin/apxs
configure.cmd       ./configure.apxs
configure.pre_args  

destroot.violate_mtree   yes
destroot.keepdirs   ${destroot}${prefix}/var/run/${name}
post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} \
        CHANGES-FCGID LICENSE-FCGID NOTICE-FCGID README-FCGID STATUS-FCGID \
        ${destroot}${prefix}/share/doc/${name}
    xinstall -m 755 -d ${destroot}${prefix}/apache2/conf/extra
    xinstall -m 644 ${filespath}/httpd-fcgid.conf \
        ${destroot}${prefix}/apache2/conf/extra/
}

notes "
==========
This port installs a configuration file to enable mod_fcgid in Apache.
After install add these lines to the end of ${prefix}/apache2/conf/httpd.conf to enable mod_fcgid.
    # Include module mod_fcgid
    Include conf/extra/httpd-fcgid.conf

You should then restart apache2 to load the module.
    $ sudo port unload apache2
    $ sudo port load apache2

For further configuration information please visit
    http://httpd.apache.org/mod_fcgid/mod/mod_fcgid.html

When upgrading from version 2.2, please see the above URL
    about deprecated config options!
=========="

livecheck.url       http://httpd.apache.org/download.cgi
livecheck.type      regex
livecheck.regex     "(?!${name}).*${name}-((?!${extract.suffix}).*)${extract.suffix}"
