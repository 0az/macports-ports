# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               conflicts_build 1.0

name                    libkml
version                 1.2.0
revision                4
license                 BSD
platforms               darwin
categories              gis
maintainers             {ryandesign @ryandesign} openmaintainer

description             library to parse, generate and operate on KML

long_description        ${name} is Google's library for use with applications \
                        that want to parse, generate and operate on KML. It \
                        is an implementation of the OGC KML 2.2 standard.

homepage                https://code.google.com/p/libkml/
master_sites            googlecode

# Development might move to one of these forks:
# https://github.com/google/libkml
# https://github.com/CPB9/libkml
# https://github.com/libkml/libkml

checksums               rmd160  f73ed3ce47d38c5d45bd04c9498a847b24c572da \
                        sha256  fae9085e4cd9f0d4ae0d0626be7acf4ad5cbb37991b9d886df29daf72df37cbc \
                        size    9041987

# If curl is found, the networking examples will be built. There is no
# configure flag to turn this off, but the examples are not installed.
#depends_build-append    port:curl

depends_build-append    port:boost

depends_lib-append      port:expat \
                        port:uriparser \
                        port:zlib

patchfiles              patch-configure.ac.diff \
                        patch-support-external-liburiparse-and-boost.diff

post-patch {
    # Fix build with clang
    fs-traverse f ${worksrcpath} {
        switch [file tail ${f}] {
            Makefile.am {
                reinplace "s| -Werror||g" ${f}
            }
        }
    }
}

conflicts               minizip
conflicts_build         minizip

use_autoreconf          yes

configure.args-append   --disable-dependency-tracking \
                        --disable-silent-rules \
                        --disable-swig \
                        --with-boost=${prefix} \
                        --with-liburiparser=${prefix}

test.run                yes
test.target             check

post-destroot {
    set docdir ${prefix}/share/doc/${subport}
    xinstall -d ${destroot}${docdir}
    xinstall -W ${worksrcpath} -m 0644 \
        AUTHORS \
        COPYING \
        ChangeLog \
        NEWS \
        README \
        ${destroot}${docdir}
}
