# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                py-qscintilla

# NOTE: The version of these python bindings must match that of the
# installed devel/qscintilla port, or configure/building will fail
# with strange error messages.

version             2.10.1
checksums           rmd160 5dbddfdaf826e95251589a41696d5786b497e86f \
                    sha256 97f98a9d91f908db6ce37fecc6d241d955b388a1c487173b60726cba9a3dfa64

categories          python devel
license             {GPL-2 GPL-3}
maintainers         {michaelld @michaelld} openmaintainer
description         Python bindings for QScintilla
homepage            http://www.riverbankcomputing.com/software/qscintilla/
platforms           darwin

long_description    Python bindings for QScintilla, \
                    a port to Qt of Neil Hodgson's Scintilla C++ editor control.

dist_subdir         qscintilla
distname            QScintilla_gpl-${version}
master_sites        sourceforge:pyqt

set python_versions {27 34 35 36}

foreach pver ${python_versions} {
    subport py${pver}-qscintilla {
        PortGroup   qt4 1.0

        worksrcdir ${worksrcdir}/Python

   depends_lib-append  port:qscintilla \
                       port:python${pver} \
                       port:py${pver}-pyqt4

   # allow configure.py to respect --spec=... argument
   patchfiles-append patch-configure.py.diff

   pre-configure {
       set cache [open "${configure.dir}/.qmake.cache" w 0644]
       puts ${cache} "CONFIG += ${qt_arch_types}"
       close ${cache}
   }

   set python_ver_dot [join [split ${pver} ""] "."]

   configure.python ${prefix}/bin/python${python_ver_dot}

   configure.pre_args

   configure.cmd       ${configure.python} configure.py
   configure.args-append \
       --pyqt=PyQt4 \
       --sip=${prefix}/bin/sip-${python_ver_dot} \
       --qmake=${qt_qmake_cmd} \
       --pyqt-sipdir=${prefix}/share/py${pver}-sip/PyQt4 \
       --apidir=${qt_data_dir}/qsci

   configure.args-append \
       --spec=${qt_qmake_spec}

   # --disable-dependency-tracking is not recognized.
   configure.universal_args-delete --disable-dependency-tracking

   post-destroot {
       move ${destroot}${qt_data_dir}/qsci/api/python/QScintilla2.api \
           ${destroot}${qt_data_dir}/qsci/api/python/QScintilla2-Python${python_ver_dot}.api
   }
}
}

if {${subport} eq ${name}} {
    use_configure no
    fetch {}
    checksum {}
    extract {}
    supported_archs noarch
    depends_lib port:py27-qscintilla
    patch {}
    build {}
    destroot {
        xinstall -d -m 755 ${destroot}${prefix}/share/doc/${name}
        system "echo $name is a stub port > ${destroot}${prefix}/share/doc/${name}/README"
    }
}

livecheck.type      regex
livecheck.url       ${homepage}download
livecheck.regex     >QScintilla-gpl\[_-\]\(\[0-9.\]+\)${extract.suffix}<
