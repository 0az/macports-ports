# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                lbdb
version             0.42
categories          mail
maintainers         nomaintainer
platforms           darwin freebsd
license             GPL-2+

description         The little brother's database for the mutt mail reader.

long_description    This package consists of a set of small tools, which \
                    collect mail addresses from several sources and offer \
                    these addresses to the mutt external query feature. \
                    It can use Emacs bbdb, abook, ldap and evec mac os x \
                    addressbook for query.

homepage            http://www.spinnaker.de/lbdb/
master_sites        http://www.spinnaker.de/debian/

checksums           rmd160  eb7aab7840b96a5adacf2da41c2770fb1d27e08f \
                    sha256  efb0de0d50a4170e7ccfa033e7b38678310b94578309e55e805cca2e06596f53

distname            ${name}_${version}
worksrcdir          ${name}-${version}

set perl_version    5.24

depends_lib         port:libiconv \
                    port:perl${perl_version}

depends_run         port:gsed

post-patch  {
    reinplace "s|sed|gsed|g" ${configure.dir}/m_muttalias.sh.in
}

configure.args      --libdir=${prefix}/lib/lbdb/ \
                    --without-gpg \
                    ac_cv_path_PERL=${prefix}/bin/perl${perl_version}

destroot.destdir    install_prefix=${destroot}

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/emacs/site-lisp
    file copy ${configure.dir}/lbdb.el ${destroot}${prefix}/share/emacs/site-lisp
}

variant gpg conflicts gpg2 description {Add support for GnuPG version 1} {
    depends_lib-append      port:gnupg
    configure.args-replace  --without-gpg --with-gpg
}

variant gpg2 conflicts gpg description {Add support for GnuPG version 2} {
    depends_lib-append      port:gnupg2
    configure.args-replace  --without-gpg --with-gpg=${prefix}/bin/gpg2
}

variant ldap {
    depends_lib-append      port:p${perl_version}-perl-ldap
}

livecheck.type      regex
livecheck.url       ${homepage}
livecheck.regex     ${name}_(\[0-9.\]+)${extract.suffix}
